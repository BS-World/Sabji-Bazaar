<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Sabji Bazaar ‚Äî Vegetables for Sale</title>

  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { padding-top: 1.5rem; padding-bottom: 5rem; background:#f8f9fa; }
    .veg-card { min-height: 260px; display:flex; flex-direction:column; justify-content:space-between; }
    .veg-img { height:130px; object-fit:cover; border-radius:.5rem; }
    .floating-bill {
      position: fixed;
      right: 20px;
      bottom: 20px;
      z-index: 2000;
      display: none;
    }
    .qty-select { width:120px; }
    .price-rupee { font-weight:700; }
    .card-footer-small { font-size:0.9rem; color:#666; }
    @media (max-width:576px) {
      .qty-select { width:100%; margin-bottom:.5rem; }
    }
  </style>
</head>
<body>

<div class="container">
  <!-- Header with cart button -->
  <header class="mb-4 d-flex justify-content-between align-items-center">
    <h1 class="h3 mb-0">Sabji Bazaar</h1>
    <button class="btn btn-outline-success position-relative" 
            type="button" data-bs-toggle="offcanvas" 
            data-bs-target="#cartPanel" aria-controls="cartPanel">
      üõí Cart
      <span id="cartBadge" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger">0</span>
    </button>
  </header>

  <!-- Vegetable Cards -->
  <section>
    <div class="row g-3" id="veg-list">
      <!-- Vegetable cards injected by JS -->
    </div>
  </section>
</div>

<!-- Floating Billing Button -->
<button id="billingBtn" class="btn btn-success rounded-pill floating-bill" title="Billing">
  <span id="billingText">Billing</span>
  <span id="billingBadge" class="badge bg-danger ms-2">0</span>
</button>

<!-- Cart Side Panel -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="cartPanel" aria-labelledby="cartPanelLabel">
  <div class="offcanvas-header">
    <h5 id="cartPanelLabel">Your Cart</h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
  </div>
  <div class="offcanvas-body d-flex flex-column">
    <div id="cart-items" class="flex-grow-1">
      <!-- Cart items go here -->
    </div>
    <div class="mt-3 border-top pt-2">
      <p><strong>Total:</strong> <span id="cartTotal">‚Çπ0.00</span></p>
      <button class="btn btn-primary w-100" onclick="openBilling()">Checkout</button>
    </div>
  </div>
</div>

<!-- Billing Modal -->
<div class="modal fade" id="billingModal" tabindex="-1" aria-labelledby="billingModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered modal-lg">
    <div class="modal-content">
      <form id="billingForm">
        <div class="modal-header">
          <h5 class="modal-title" id="billingModalLabel">Billing & Address</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          <div id="order-summary" class="mb-3"></div>

          <div class="mb-3">
            <label for="address" class="form-label">Delivery Address</label>
            <textarea id="address" class="form-control" rows="3" placeholder="Write full delivery address here..."></textarea>
          </div>

          <div class="mb-0">
            <p class="mb-1"><strong>Total Amount:</strong> <span id="modalTotal">‚Çπ0.00</span></p>
            <p class="card-footer-small">When you press Submit, your order details will be opened in WhatsApp for sending.</p>
          </div>

        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button id="submitOrder" type="submit" class="btn btn-primary">Submit & Send to WhatsApp</button>
        </div>
      </form>
    </div>
  </div>
</div>

<!-- Bootstrap 5 JS + Popper -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
  // Vegetables
  const vegetables = [
    { id:1, name:'Tomato', pricePerKg:60, img:'https://images.unsplash.com/photo-1582515073490-399813f1be12?auto=format&fit=crop&w=800&q=60' },
    { id:2, name:'Potato', pricePerKg:35, img:'https://images.unsplash.com/photo-1604908177522-94c9d6d4b0f5?auto=format&fit=crop&w=800&q=60' },
    { id:3, name:'Onion', pricePerKg:50, img:'https://images.unsplash.com/photo-1542444459-db4b6ef8f1f0?auto=format&fit=crop&w=800&q=60' },
    { id:4, name:'Carrot', pricePerKg:90, img:'https://images.unsplash.com/photo-1542838132-92c53300491e?auto=format&fit=crop&w=800&q=60' },
    { id:5, name:'Eggplant (Brinjal)', pricePerKg:70, img:'https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?auto=format&fit=crop&w=800&q=60' },
    { id:6, name:'Spinach', pricePerKg:40, img:'https://images.unsplash.com/photo-1558642452-9d2a7deb7f62?auto=format&fit=crop&w=800&q=60' },
    { id:7, name:'Cauliflower', pricePerKg:80, img:'https://images.unsplash.com/photo-1567303312678-3d8f5a1ad6a6?auto=format&fit=crop&w=800&q=60' },
    { id:8, name:'Cucumber', pricePerKg:45, img:'https://images.unsplash.com/photo-1567306226416-28f0efdc88ce?auto=format&fit=crop&w=800&q=60' },
    { id:9, name:'Capsicum', pricePerKg:120, img:'https://images.unsplash.com/photo-1622203913724-9f7c7bd3e2b9?auto=format&fit=crop&w=800&q=60' },
    { id:10, name:'Green Beans', pricePerKg:110, img:'https://images.unsplash.com/photo-1601004890684-d8cbf643f5f2?auto=format&fit=crop&w=800&q=60' },
    { id:11, name:'Green Peas', pricePerKg:130, img:'https://images.unsplash.com/photo-1506801310323-534be5e7bb06?auto=format&fit=crop&w=800&q=60' },
    { id:12, name:'Bottle Gourd (Lauki)', pricePerKg:60, img:'https://images.unsplash.com/photo-1543353071-087092ec393a?auto=format&fit=crop&w=800&q=60' }
  ];

  // Cart
  let cart = [];
  const vegListEl = document.getElementById('veg-list');
  const billingBtn = document.getElementById('billingBtn');
  const billingBadge = document.getElementById('billingBadge');
  const billingModal = new bootstrap.Modal(document.getElementById('billingModal'), {});
  const orderSummaryEl = document.getElementById('order-summary');
  const modalTotalEl = document.getElementById('modalTotal');
  const addressEl = document.getElementById('address');
  const cartItemsEl = document.getElementById('cart-items');
  const cartTotalEl = document.getElementById('cartTotal');
  const cartBadge = document.getElementById('cartBadge');

  // Quantity options
  const qtyOptions = [
    {label:'250 gm', factor:0.25},
    {label:'500 gm', factor:0.5},
    {label:'1 kg', factor:1}
  ];

  // Render vegetable cards
  function renderVegetables() {
    vegListEl.innerHTML = '';
    vegetables.forEach(v => {
      const col = document.createElement('div');
      col.className = 'col-12 col-sm-6 col-md-4 col-lg-3';
      col.innerHTML = `
        <div class="card veg-card shadow-sm h-100">
          <img src="${v.img}" class="card-img-top veg-img" alt="${v.name}">
          <div class="card-body d-flex flex-column">
            <div>
              <h5 class="card-title mb-1">${v.name}</h5>
              <p class="mb-2 card-footer-small">Price: <span class="price-rupee">‚Çπ${v.pricePerKg.toFixed(2)}</span> / kg</p>
            </div>
            <div class="mt-auto">
              <div class="d-flex gap-2 align-items-center">
                <select class="form-select form-select-sm qty-select" id="qty-${v.id}">
                  ${qtyOptions.map(q => `<option value="${q.factor}">${q.label}</option>`).join('')}
                </select>
                <button class="btn btn-outline-primary btn-sm w-100" onclick="addToCart(${v.id})">Add to cart</button>
              </div>
            </div>
          </div>
        </div>`;
      vegListEl.appendChild(col);
    });
  }

  // Add to cart
  function addToCart(vegId) {
    const veg = vegetables.find(x=>x.id===vegId);
    const select = document.getElementById(`qty-${vegId}`);
    const factor = Number(select.value);
    const qtyLabel = qtyOptions.find(q=>q.factor===factor).label;
    const amount = +(veg.pricePerKg * factor).toFixed(2);

    cart.push({ id: veg.id, name: veg.name, qtyLabel, qtyFactor: factor, pricePerKg: veg.pricePerKg, amount });
    updateBillingButton();
    renderCartPanel();
    showAddedToast(`${veg.name} (${qtyLabel}) added ‚Äî ‚Çπ${amount.toFixed(2)}`);
  }

  // Update floating billing button
  function updateBillingButton() {
    const count = cart.length;
    if (count > 0) {
      billingBtn.style.display = 'inline-block';
      billingBadge.textContent = count;
      const total = cart.reduce((s,it)=>s+it.amount,0);
      document.getElementById('billingText').innerHTML = `Billing ‚Ä¢ ‚Çπ${total.toFixed(2)}`;
    } else {
      billingBtn.style.display = 'none';
    }
  }

  // Cart Panel
  function renderCartPanel() {
    if (cart.length === 0) {
      cartItemsEl.innerHTML = '<p class="text-muted">Your cart is empty.</p>';
      cartTotalEl.textContent = '‚Çπ0.00';
      cartBadge.textContent = '0';
      return;
    }
    let html = `<div class="list-group">`;
    cart.forEach((it, idx) => {
      html += `
        <div class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <strong>${it.name}</strong><br>
            <select class="form-select form-select-sm mt-1" style="width:120px"
                    onchange="updateCartQty(${idx}, this.value)">
              ${qtyOptions.map(q => `<option value="${q.factor}" ${q.factor===it.qtyFactor?'selected':''}>${q.label}</option>`).join('')}
            </select>
          </div>
          <div class="text-end">
            <div>‚Çπ${it.amount.toFixed(2)}</div>
            <button class="btn btn-sm btn-outline-danger mt-1" onclick="removeFromCart(${idx})">‚ùå</button>
          </div>
        </div>`;
    });
    html += `</div>`;
    cartItemsEl.innerHTML = html;
    const total = cart.reduce((s,it)=>s+it.amount,0);
    cartTotalEl.textContent = `‚Çπ${total.toFixed(2)}`;
    cartBadge.textContent = cart.length;
  }

  // Remove item
  function removeFromCart(index) {
    cart.splice(index, 1);
    updateBillingButton();
    renderCartPanel();
    renderOrderSummary();
  }

  // Update qty in cart
  function updateCartQty(index, newFactor) {
    const item = cart[index];
    const factor = Number(newFactor);
    const qtyLabel = qtyOptions.find(q=>q.factor===factor).label;
    const amount = +(item.pricePerKg * factor).toFixed(2);
    cart[index] = {...item, qtyFactor: factor, qtyLabel, amount};
    renderCartPanel();
    renderOrderSummary();
    updateBillingButton();
  }

  // Open billing modal from cart panel
  function openBilling() {
    renderOrderSummary();
    const offcanvas = bootstrap.Offcanvas.getInstance(document.getElementById('cartPanel'));
    offcanvas.hide();
    billingModal.show();
  }

  // Render order summary in modal
  function renderOrderSummary() {
    if (cart.length === 0) {
      orderSummaryEl.innerHTML = '<p class="text-muted">Cart is empty.</p>';
      modalTotalEl.textContent = '‚Çπ0.00';
      return;
    }
    let html = `<div class="table-responsive"><table class="table table-sm align-middle">
      <thead><tr><th>Item</th><th>Quantity</th><th>Price / kg</th><th>Amount</th><th></th></tr></thead><tbody>`;
    cart.forEach((it, idx) => {
      html += `<tr>
        <td>${it.name}</td>
        <td>
          <select class="form-select form-select-sm" onchange="updateCartQty(${idx}, this.value)">
            ${qtyOptions.map(q=>`<option value="${q.factor}" ${q.factor===it.qtyFactor?'selected':''}>${q.label}</option>`).join('')}
          </select>
        </td>
        <td>‚Çπ${it.pricePerKg.toFixed(2)}</td>
        <td>‚Çπ${it.amount.toFixed(2)}</td>
        <td><button class="btn btn-sm btn-danger" onclick="removeFromCart(${idx})">‚ùå</button></td>
      </tr>`;
    });
    html += `</tbody></table></div>`;
    orderSummaryEl.innerHTML = html;
    const total = cart.reduce((s,it)=>s+it.amount,0);
    modalTotalEl.textContent = `‚Çπ${total.toFixed(2)}`;
  }

  // Toast message
  function showAddedToast(text) {
    const toast = document.createElement('div');
    toast.className = 'alert alert-success position-fixed';
    toast.style.right = '20px';
    toast.style.bottom = '90px';
    toast.style.zIndex = 2200;
    toast.style.minWidth = '200px';
    toast.textContent = text;
    document.body.appendChild(toast);
    setTimeout(()=> { toast.style.transition = 'opacity 400ms'; toast.style.opacity = 0; }, 1200);
    setTimeout(()=> toast.remove(), 1800);
  }

  // Billing button ‚Üí modal
  billingBtn.addEventListener('click', ()=>{ renderOrderSummary(); billingModal.show(); });

  // Submit billing form
  document.getElementById('billingForm').addEventListener('submit', function(e){
    e.preventDefault();
    const address = addressEl.value.trim();
    if (!address) { addressEl.classList.add('is-invalid'); addressEl.focus(); return; }
    addressEl.classList.remove('is-invalid');
    if (cart.length===0) { alert('Cart is empty.'); return; }

    let msgLines = [];
    msgLines.push('üõí *Sabji Bazaar Order*','');
    msgLines.push('*Items:*');
    cart.forEach((it, idx)=>{ msgLines.push(`${idx+1}. ${it.name} ‚Äî ${it.qtyLabel} ‚Äî ‚Çπ${it.amount.toFixed(2)}`); });
    const total = cart.reduce((s,it)=>s+it.amount,0);
    msgLines.push('',`*Total Amount:* ‚Çπ${total.toFixed(2)}`,'',`*Delivery Address:*`,address,'','Please confirm. Thank you! üôè');
    const message = msgLines.join('\n');

    billingModal.hide();
    const phone = '916261627344'; // India code + your number
    const url = 'https://wa.me/' + phone + '?text=' + encodeURIComponent(message);
    window.open(url, '_blank');

    cart = [];
    updateBillingButton();
    renderCartPanel();
    addressEl.value = '';
  });

  // Init
  renderVegetables();
  updateBillingButton();
  renderCartPanel();
</script>
</body>
</html>
